import"./modulepreload-polyfill-3cfb730f.js";import{H as S}from"./handlebars-aa0ac26f.js";const I='<li class="student-item" data-index="{{_index}}"><h2 class="student-title">Новина №{{addOne _index}}</h2><div class="student-text"><p>Автор:&nbsp;{{author}}</p><p>Id:&nbsp;{{id}}</p><p>Заголовок:&nbsp;{{title}}</p><p>Опис:&nbsp;{{description}}</p><p>Вміст:&nbsp;{{content}}</p></div><div class="student-actions"><button class="edit-btn" data-index="{{_index}}">Edit</button><button class="delete-btn" data-index="{{_index}}">Delete</button></div></li>';//! імпортування бібліотеки HandeBars
S.registerHelper("addOne",function(n){return n+1});const P=S.compile(I);//! знаходимо всі елементи з розмітки
const h=document.querySelector(".backdrop"),$=document.querySelector(".confirm-button"),B=document.querySelector(".delete-button"),g=document.getElementById("news-info-form"),f=document.querySelector(".news-list"),q=document.querySelector(".buttonOpn"),L=document.querySelector(".backdrop-1"),_=document.querySelector(".formCloseBtn"),x=document.querySelector(".backdrop-edit"),i=document.getElementById("edit-news-form"),N=document.getElementById("fetch"),T=document.querySelector(".per-page"),k=document.querySelector(".page"),j=document.querySelector(".prev-button"),D=document.querySelector(".next-button"),O=document.getElementById("news-num"),C=document.getElementById("page-num"),H=document.getElementById("total-pages");let r=1,c=[];const p="http://localhost:3000/",y="articles?";function b(){return T.value||5}function A(){return Number(k.value)}//! завантажуємо дані з сервера
function w(){const n=b();r=A(),fetch(`${p}${y}_page=${r}&_per_page=${n}`).then(function(e){if(!e.ok)throw new Error("Помилка при завантаженні даних");return e.json()}).then(e=>{console.log(e),c=(Array.isArray(e.data)?e.data:[]).map((s,a)=>({_index:a,id:s.id,author:s.author||"Невідомо",title:s.title||"Без назви",description:s.description||"Немає опису",content:s.content||"—"})),m(c),v=e.items||0;const t=b();E=Math.ceil(v/t),H.textContent=E,C.textContent=r,O.textContent=v,console.log(b()),console.log(`${p}${y}_page=${r}&_per_page=${t}`)}).catch(function(e){console.error("Помилка завантаження:",e)})}//! відкриття модалки для додавання
q.addEventListener("click",function(){L.classList.remove("is-hidden")});_.addEventListener("click",function(){L.classList.add("is-hidden")});//! додаємо статтю/новину вручну
g.addEventListener("submit",function(n){n.preventDefault();try{const e=new FormData(g),o=Object.fromEntries(e.entries());fetch("http://localhost:3000/articles").then(t=>t.json()).then(t=>{const s=t[t.length-1];console.log("Останній елемент:",s);const a=s?Number(s.id):0;return o.id=a+1,fetch(`${p}${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}).then(t=>{if(!t.ok)throw new Error("Помилка при надсиланні даних на сервер");return t.json()}).then(t=>{console.log("Успішно створена новина на сервер:",t),c.push(t),m(c),g.reset(),L.classList.add("is-hidden")}).catch(t=>{console.error("Помилка:",t)})}catch(e){console.error("Помилка:",e)}});//! функція яка рендерить список
function m(n){f.innerHTML="",n.forEach((e,o)=>{e._index=o;const t=P(e);f.insertAdjacentHTML("beforeend",t)})}//! видалення
let d=null;f.addEventListener("click",function(n){if(n.target.classList.contains("delete-btn")){const e=parseInt(n.target.dataset.index,10);if(isNaN(e))return;d=e,h.classList.remove("is-hidden")}});$.addEventListener("click",()=>{if(d===null)return;const e=c[d].id;if(!e){console.error("❌ Помилка: елемент не має id, тому його не можна видалити із сервера."),c.splice(d,1),m(c),h.classList.add("is-hidden"),d=null;return}const o=`${p}articles/${e}`;fetch(o,{method:"DELETE",headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(s=>{if(!s.ok)throw new Error("Не вдалося видалити запис із сервера");console.log(`✅ Стаття з id=${e} видалена`)}).catch(s=>{console.error("❌ Помилка DELETE:",s)}).finally(()=>{c.splice(d,1),m(c),h.classList.add("is-hidden"),d=null})});B.addEventListener("click",()=>{d=null,h.classList.add("is-hidden")});//! редагування
let u=null;f.addEventListener("click",n=>{if(n.target.classList.contains("edit-btn")){const e=parseInt(n.target.dataset.index,10);if(isNaN(e)||!c[e])return;const o=c[e];u=e,i.elements.author.value=o.author,i.elements.title.value=o.title,i.elements.description.value=o.description,i.elements.content.value=o.content,x.classList.remove("is-hidden")}});i.addEventListener("submit",n=>{n.preventDefault();const e=new FormData(i),o=Object.fromEntries(e.entries()),t=c[u],s=t.id;c[u]={...t,...o},m(c);const a=`${p}articles/${s}`;fetch(a,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(l=>{if(!l.ok)throw new Error("Не вдалося оновити сервер");return l.json()}).then(l=>console.log("Стаття оновлена:",l)).catch(l=>console.error("Помилка:",l)),i.reset(),x.classList.add("is-hidden"),u=null});i.querySelector(".cancel-edit-modal").addEventListener("click",()=>{i.reset(),x.classList.add("is-hidden"),u=null});let v=0,E=1;N.addEventListener("click",w);j.addEventListener("click",F);D.addEventListener("click",M);function F(){r<=1||(r--,k.value=r,w())}function M(){r>=E||(r++,k.value=r,w())}
