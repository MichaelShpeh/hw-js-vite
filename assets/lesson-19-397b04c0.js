import"./modulepreload-polyfill-3cfb730f.js";import{H as k}from"./handlebars-aa0ac26f.js";const I='<li class="student-item" data-index="{{_index}}"><h2 class="student-title">Новина №{{addOne _index}}</h2><div class="student-text"><p>Автор:&nbsp;{{author}}</p><p>Id:&nbsp;{{id}}</p><p>Заголовок:&nbsp;{{title}}</p><p>Опис:&nbsp;{{description}}</p><p>Вміст:&nbsp;{{content}}</p></div><div class="news-actions"><button class="edit-btn" data-index="{{_index}}">Edit</button><button class="delete-btn" data-index="{{_index}}">Delete</button></div></li>';//! імпортування бібліотеки HandeBars
k.registerHelper("addOne",function(e){return e+1});const B=k.compile(I);//! знаходимо всі елементи з розмітки
const m=document.querySelector(".backdrop"),P=document.querySelector(".confirm-button"),q=document.querySelector(".delete-button"),y=document.getElementById("news-info-form"),f=document.querySelector(".news-list"),N=document.querySelector(".buttonOpn"),v=document.querySelector(".backdrop-1"),T=document.querySelector(".formCloseBtn"),E=document.querySelector(".backdrop-edit"),r=document.getElementById("edit-news-form"),$=document.getElementById("fetch"),j=document.querySelector(".per-page"),w=document.querySelector(".page"),D=document.querySelector(".prev-button"),O=document.querySelector(".next-button"),_=document.getElementById("news-num"),C=document.getElementById("page-num"),H=document.getElementById("total-pages");let i=1,s=[];const h="http://localhost:3000/",S="articles?";function A(){return j.value||5}function F(){return Number(w.value)}//! завантажуємо дані з сервера
async function L(){try{const e=A();i=F();const t=await fetch(`${h}${S}_page=${i}&_per_page=${e}`);if(!t.ok)throw new Error("Помилка при завантаженні даних");const n=await t.json();console.log(n),s=(Array.isArray(n.data)?n.data:[]).map((o,d)=>({_index:d,id:o.id,author:o.author||"Невідомо",title:o.title||"Без назви",description:o.description||"Немає опису",content:o.content||"—"})),u(s),g=n.items||0,b=Math.ceil(g/e),H.textContent=b,C.textContent=i,_.textContent=g}catch(e){console.error("Помилка завантаження:",e)}}//! відкриття модалки для додавання
N.addEventListener("click",function(){v.classList.remove("is-hidden")});T.addEventListener("click",function(){v.classList.add("is-hidden")});//! додаємо статтю/новину вручну
y.addEventListener("submit",async function(e){e.preventDefault();try{const t=new FormData(y),n=Object.fromEntries(t.entries()),c=await fetch("http://localhost:3000/articles");if(!c.ok)throw new Error("Помилка при надсиланні даних на сервер");const o=await c.json(),d=o[o.length-1];console.log("Останній елемент:",d);const p=d?Number(d.id):0;n.id=p+1;const x=await(await fetch(`${h}${S}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();console.log("Успішно створена новина на сервер:",x),s.push(x),u(s),y.reset(),v.classList.add("is-hidden")}catch(t){console.error("Помилка:",t)}});//! функція яка рендерить список
function u(e){f.innerHTML="",e.forEach((t,n)=>{t._index=n;const c=B(t);f.insertAdjacentHTML("beforeend",c)})}//! видалення
let a=null;f.addEventListener("click",function(e){if(e.target.classList.contains("delete-btn")){const t=parseInt(e.target.dataset.index,10);if(isNaN(t))return;a=t,m.classList.remove("is-hidden")}});P.addEventListener("click",async()=>{try{if(a===null)return;const t=s[a].id;if(!t){console.error("❌ Помилка: елемент не має id, тому його не можна видалити із сервера."),s.splice(a,1),u(s),m.classList.add("is-hidden"),a=null;return}const n=`${h}articles/${t}`;if(!(await fetch(n,{method:"DELETE",headers:{"Content-Type":"application/json; charset=UTF-8"}})).ok)throw new Error("Не вдалося видалити запис із сервера");console.log(`✅ Стаття з id=${t} видалена`)}catch(e){console.error("❌ Помилка DELETE:",e)}finally{s.splice(a,1),u(s),m.classList.add("is-hidden"),a=null}});q.addEventListener("click",()=>{a=null,m.classList.add("is-hidden")});//! редагування
let l=null;f.addEventListener("click",async e=>{if(e.target.classList.contains("edit-btn")){const t=parseInt(e.target.dataset.index,10);if(isNaN(t)||!s[t])return;const n=s[t];l=t,r.elements.author.value=n.author,r.elements.title.value=n.title,r.elements.description.value=n.description,r.elements.content.value=n.content,E.classList.remove("is-hidden")}});r.addEventListener("submit",async e=>{try{e.preventDefault();const t=new FormData(r),n=Object.fromEntries(t.entries()),c=s[l],o=c.id;s[l]={...c,...n},u(s);const d=`${h}articles/${o}`,p=await fetch(d,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!p.ok)throw new Error("Не вдалося оновити сервер");return r.reset(),E.classList.add("is-hidden"),l=null,p.json()}catch(t){console.error("Помилка:",t)}});r.querySelector(".cancel-edit-modal").addEventListener("click",()=>{r.reset(),E.classList.add("is-hidden"),l=null});let g=0,b=1;$.addEventListener("click",L);D.addEventListener("click",M);O.addEventListener("click",R);function M(){i<=1||(i--,w.value=i,L())}function R(){i>=b||(i++,w.value=i,L())}
