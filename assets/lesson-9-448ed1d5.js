import"./modulepreload-polyfill-3cfb730f.js";import{H as S}from"./handlebars-aa0ac26f.js";const y='<li class="student-item" data-index="{{_index}}"><h2 class="student-title">Студент №{{addOne _index}}</h2><div class="student-text"><p>{{name}}</p><p>{{second-name}}</p><p>{{age}}</p><p>{{course}}</p><p>{{faculty}}</p></div><div class="student-actions"><button class="edit-btn" data-index="{{_index}}">Edit</button><button class="delete-btn" data-index="{{_index}}">Delete</button></div></li>';//! імпортування бібліотеки HandeBars
S.registerHelper("addOne",function(e){return e+1});const L=S.compile(y);//! знаходимо всі елементи з розмітки
const p=document.querySelector(".backdrop"),b=document.querySelector(".confirm-button"),h=document.querySelector(".delete-button"),u=document.getElementById("student-info-form"),l=document.getElementById("students-list"),E=document.querySelector(".buttonOpn"),v=document.querySelector(".backdrop-1"),x=document.querySelector(".formCloseBtn"),m=document.querySelector(".backdrop-edit"),n=document.getElementById("edit-student-form");document.querySelector(".cancel-edit-modal");E.addEventListener("click",function(){v.classList.remove("is-hidden")});x.addEventListener("click",function(){v.classList.add("is-hidden")});let a=[];//! завантаження з localstorage або students.json
if(!localStorage.getItem("students"))fetch("students.json").then(e=>e.json()).then(e=>{a=e;const t=JSON.stringify(a);localStorage.setItem("students",t),c(t)}).catch(e=>console.error("Помилка завантаження JSON:",e));else try{a=JSON.parse(localStorage.getItem("students")),c(JSON.stringify(a))}catch(e){console.error("Помилка при зчитуванні з localStorage:",e)}//! додаємо студента
u.addEventListener("submit",function(e){e.preventDefault();try{const t=new FormData(u),s=Object.fromEntries(t.entries());a.push(s),f(),c(localStorage.getItem("students")),u.reset(),v.classList.add("is-hidden")}catch(t){console.error(t)}});//! функція яка додає студента в список
function c(e){try{const t=JSON.parse(e);l.innerHTML='<li class="item">Список студентів:</li>',t.forEach((s,g)=>{s._index=g;try{const r=L(s);l.insertAdjacentHTML("beforeend",r)}catch(r){console.error(r)}})}catch(t){console.error(t)}}//! оновлюємо localstorage
function f(){try{const e=JSON.stringify(a);localStorage.setItem("students",e)}catch(e){console.error("Помилка JSON.stringify:",e)}}//! відкриття модалки
let d=null;l.addEventListener("click",function(e){if(e.target.classList.contains("delete-btn")){const t=parseInt(e.target.dataset.index,10);if(isNaN(t))return;d=t,p.classList.remove("is-hidden")}});//! підтвердити видалення
b.addEventListener("click",()=>{d!==null&&(a.splice(d,1),f(),c(localStorage.getItem("students")),d=null),p.classList.add("is-hidden")});//! скасувати видалення
h.addEventListener("click",()=>{d=null,p.classList.add("is-hidden")});//! редагування студента
let o=null;l.addEventListener("click",e=>{if(e.target.classList.contains("edit-btn")){const t=parseInt(e.target.dataset.index,10);if(isNaN(t)||!a[t])return;const s=a[t];o=t,n.elements.name.value=s.name,n.elements["second-name"].value=s["second-name"],n.elements.age.value=s.age,n.elements.course.value=s.course,n.elements.faculty.value=s.facult,n.addEventListener("submit",g=>{g.preventDefault();try{const r=new FormData(n),i=Object.fromEntries(r.entries());i.age=Number(i.age),console.log("updatedStudent:",i),a[o]=i,f(),c(localStorage.getItem("students"))}catch(r){console.error(r)}finally{n.reset(),m.classList.add("is-hidden"),o=null}}),n.querySelector(".cancel-edit").addEventListener("click",()=>{u.id="student-info-form",n.remove()})}});l.addEventListener("click",e=>{if(e.target.classList.contains("edit-btn")){const t=parseInt(e.target.dataset.index,10);if(isNaN(t)||!a[t])return;const s=a[t];o=t,n.elements.name.value=s.name,n.elements["second-name"].value=s["second-name"],n.elements.age.value=s.age,n.elements.course.value=s.course,n.elements.faculty.value=s.faculty,m.classList.remove("is-hidden")}});//! підтвердження змінення
n.addEventListener("submit",e=>{e.preventDefault();try{const t=new FormData(n),s=Object.fromEntries(t.entries());a[o]=s,f(),c(localStorage.getItem("students"))}catch(t){console.error(t)}finally{n.reset(),m.classList.add("is-hidden"),o=null}});//! скасування змінення
document.querySelector(".cancel-edit").addEventListener("click",()=>{n.reset(),m.classList.add("is-hidden"),o=null});
